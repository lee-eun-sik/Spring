<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê³µì§€ì‚¬í•­ ê¸€ ì‘ì„±</title>
    <script src="/js/jquery-3.7.1.min.js"></script>
    <script src="/js/tinymce/tinymce.min.js?ver=1"></script>
    <script src="/js/edit.js?ver=1"></script>
	<script src="/js/common.js?ver=1.0.1"></script>
	<style>
	        .notice-wrapper {
	            background: #ddd;
	            padding: 20px;
	            width: 1200px;
	            margin: 0 auto;
	            border-radius: 8px;
	        }

	        .notice-wrapper h2 {
	            text-align: center;
	        }

	        .notice-wrapper label {
	            display: block;
	            margin-top: 10px;
	        }

	        .notice-wrapper input[type="text"],
	        .notice-wrapper textarea {
	            width: 100%;
	            padding: 8px;
	            margin-top: 5px;
	            border: 1px solid #aaa;
	            border-radius: 4px;
	        }

	        #dropZone {
	            margin-top: 10px;
	            padding: 10px;
	            background-color: #f1f1f1;
	            border: 2px dashed #999;
	            text-align: center;
	            cursor: pointer;
	        }

	        .file-list {
	            list-style: none;
	            margin-top: 10px;
	        }

	        .file-list li {
	            margin-bottom: 5px;
	        }

	        .btn-group {
	            display: flex;
	            justify-content: space-between;
	            margin-top: 15px;
	        }

	        .btn-upload,
	        .btn-submit {
	            padding: 10px 20px;
	            border: none;
	            border-radius: 6px;
	            cursor: pointer;
	        }

	        .btn-upload {
	            background-color: black;
	            color: white;
	        }

	        .btn-submit {
	            background-color: red;
	            color: white;
	        }
	    </style>
    <script>
        $(document).ready(function () {
			$("#background").hide();
			$("#p").hide(); // ë‹¨ë½ ìˆ¨ê¸°ê¸°
			$("#p1").hide(); //ë‹¨ë½ ìˆ¨ê¸°ê¸°
			$("#join").hide(); // íšŒì›ê°€ì… ë²„íŠ¼ ìˆ¨ê¸°ê¸°
			$("#login").hide(); // ë¡œê·¸ì¸ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            let editor = editInit("content");

            let uploadedFiles = setupFileUpload({
                dropZone: '#dropZone',
                fileInput: '#fileUploadBtn',
                fileList: '#fileList',
                maxFileSize: 50 * 1024 * 1024
            });

            $("#noticeForm").submit(function (e) {
                e.preventDefault();

                let title = $("#title").val().trim();
                let content = tinymce.get('content').getContent({format: 'text'});

                if (!validationUtil.isEmpty(title)) {
                    alert("ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    $("#title").focus();
                    return;
                }

                if (!validationUtil.maxLength(title, 100)) {
                    alert("ì œëª©ì€ ìµœëŒ€ 100ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                    $("#title").focus();
                    return;
                }

                if (!validationUtil.isEmpty(content)) {
                    alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    $("#content").focus();
                    return;
                }

                if (!validationUtil.maxLength(content, 2000)) {
                    alert("ë‚´ìš©ì€ ìµœëŒ€ 2000ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                    $("#content").focus();
                    return;
                }

                let formData = new FormData();
                formData.append("title", title);
                formData.append("content", tinymce.get('content').getContent());
                formData.append("viewCount", 0);

                for (let i = 0; i < uploadedFiles.length; i++) {
                    formData.append("files", uploadedFiles[i]);
                }

                ajaxRequestFile(
                    "[[${apiBaseUrl}]]/api/newboard/notice.do",
                    formData,
                    function (response) {
                        if (response.success) {
                            alert("ê³µì§€ì‚¬í•­ ë“±ë¡ ì„±ê³µ!");
                            window.location.href = "[[${apiBaseUrl}]]/api/newboard/newboard.do";
                        } else {
                            alert("ë“±ë¡ ì‹¤íŒ¨: " + response.message);
                        }
                    }
                );
            });
        });
    </script>
    
</head>
<body>
<div layout:fragment="content" class="notice-wrapper">
	<div th:replace="~{fragments/header :: header}"></div>
    <h2>ê³µì§€ì‚¬í•­ ê¸€ ì‘ì„±</h2>
    <form id="noticeForm">
        <label for="title">ì œëª©</label>
        <input type="text" id="title" name="title" maxlength="100" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">

        <label for="content">ë‚´ìš©</label>
        <textarea id="content" name="content" rows="10"></textarea>

        <div id="dropZone">íŒŒì¼ ì—…ë¡œë“œ ëª©ë¡</div>
        <input type="file" id="fileUploadBtn" name="files" multiple style="display:none;">
        <ul id="fileList" class="file-list"></ul>
        <input type="hidden" id="viewCount" name="viewCount" value="0"/>

        <div class="btn-group">
            <button type="button" class="btn-upload" onclick="$('#fileUploadBtn').click()">ğŸ“ íŒŒì¼ ì—…ë¡œë“œ</button>
            <button type="submit" class="btn-submit">ğŸ“ ê³µì§€ì‚¬í•­ ì‘ì„±</button>
        </div>
    </form>
</div>
</body>
</html>