<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>íšŒì› ëª©ë¡ ê´€ë¦¬</title>
    <script src="/js/jquery-3.7.1.min.js"></script>
    <style>
        /* Your existing styles */
    </style>
</head>
<body>
	<div th:replace="~{fragments/header :: header}"></div>
<h2>ê°€ì…ëœ íšŒì›ëª©ë¡</h2>
<div>
    <button type="button" onclick="location.href='/user/main'">ë§ˆì´í˜ì´ì§€</button>
    <button type="button" onclick="location.href='/reservation/reservationlist'">ì˜ˆì•½ê´€ë¦¬</button>
    <button type="button" onclick="location.href='/member/memberlist'">íšŒì›ê´€ë¦¬</button>
</div>

<table border="1" id="memberListTable">
    <thead>
        <tr>
            <th>ì´ë¦„</th>
            <th>ì„±ë³„</th>
            <th>ì•„ì´ë””</th>
            <th>ë¹„ë°€ë²ˆí˜¸</th>
            <th>ì „í™”ë²ˆí˜¸</th>
            <th>ì´ë©”ì¼</th>
            <th>ê°€ì…ì¼ì</th>
            <th>ê´€ë¦¬</th>
        </tr>
    </thead>
    <tbody>
        <!-- Member rows will be populated by AJAX -->
    </tbody>
</table>

<!-- í˜ì´ì§€ë„¤ì´ì…˜ ë° ê²€ìƒ‰ UIëŠ” ë³´ë¥˜ ìƒíƒœì´ë¯€ë¡œ ë¹„í™œì„± -->
<div class="search-container">
    <select id="searchType">
        <option value="user_id">ì•„ì´ë””</option>
        <option value="user_name">ì´ë¦„</option>
    </select>
    <div class="search-box">
        <input type="text" id="searchKeyword" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
        <button onclick="searchMember()" class="search-btn">ğŸ”</button>
    </div>
</div>

<script type="text/javascript">
    // Fetch and display members on page load
    function loadMemberList(page=1) {
        $.ajax({
            url: "[[${apiBaseUrl}]]/api/member/list.do",
            method: "GET",
            data: { page: page },
            success: function(response) {
                const userList = response.data;
                const tbody = $("#memberListTable tbody");
                tbody.empty(); // Clear previous rows
                if (userList.length === 0) {
                    tbody.append('<tr><td colspan="8" style="text-align: center;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>');
                } else {
                    userList.forEach(user => {
                        tbody.append(`
                            <tr>
                                <td>${user.username}</td>
                                <td>${user.gender}</td>
                                <td>${user.userId}</td>
                                <td>****</td>
                                <td>${user.phonenumber}</td>
                                <td>${user.email}</td>
                                <td>${user.createDt}</td>
                                <td><button onclick="deleteUser('${user.userId}')">íƒˆí‡´</button></td>
                            </tr>
                        `);
                    });
                }
            }
        });
    }

    // Delete user via AJAX
    function deleteUser(userId) {
        if (confirm(`${userId} íšŒì›ì„ ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            $.ajax({
                url: "[[${apiBaseUrl}]]/api/member/delete.do",
                method: "POST",
                data: { userId: userId },
                success: function(response) {
                    alert(response.message);
                    loadMemberList(); // Reload the member list after deletion
                },
                error: function() {
                    alert("íšŒì› íƒˆí‡´ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            });
        }
    }

	// Search functionality
	function searchMember() {
	    const type = $("#searchType").val();
	    const keyword = $("#searchKeyword").val().trim();
	    
	    if (!keyword) {
	        alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
	        return;
	    }
	    
	    $.ajax({
	        url: "[[${apiBaseUrl}]]/api/member/list.do",
	        method: "GET",
	        data: { 
	            searchType: type, 
	            searchKeyword: keyword,
	            page: 1  // Search starts from page 1
	        },
	        success: function(response) {
				console.log(response)
	            const userList = response.data;
	            const tbody = $("#memberListTable tbody");
	            tbody.empty(); // Clear previous rows

	            if (userList.length === 0) {
	                tbody.append('<tr><td colspan="8" style="text-align: center;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>');
	            } else {
	                userList.forEach(user => {
	                    tbody.append(`
	                        <tr>
	                            <td>${user.username}</td>
	                            <td>${user.gender}</td>
	                            <td>${user.userId}</td>
	                            <td>****</td>
	                            <td>${user.phonenumber}</td>
	                            <td>${user.email}</td>
	                            <td>${user.createDt}</td>
	                            <td><button onclick="deleteUser('${user.userId}')">íƒˆí‡´</button></td>
	                        </tr>
	                    `);
	                });
	            }
	        }
	    });
	}

    // Initialize the member list
    $(document).ready(function() {
		$("#background").hide(); // í—¤ë” ë°°ê²½ ì‚¬ì§„ ìˆ¨ê¸°ê¸°
		$("#p").hide(); // ë‹¨ë½ ìˆ¨ê¸°ê¸°
		$("#p1").hide(); //ë‹¨ë½ ìˆ¨ê¸°ê¸°
		$("#join").hide(); // íšŒì›ê°€ì… ë²„íŠ¼ ìˆ¨ê¸°ê¸°
		$("#login").hide(); // ë¡œê·¸ì¸ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        loadMemberList(); // Initial load
    });
</script>

</body>
</html>